!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7a734c8d-7511-49b4-b617-2f848fe4f7c9",e._sentryDebugIdIdentifier="sentry-dbid-7a734c8d-7511-49b4-b617-2f848fe4f7c9")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[916],{67269:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/report-fetcher/scp",function(){return a(4984)}])},66158:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(17613),r=a.n(n);class l{}l.transformWeeklyDateString=e=>{let t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=e.split(" | "),n=a[0],r=a[1].split(", "),l=r[0].split(" - "),i=r[1],s=n.replace(/Week\s/,""),[o,d]=l,c=new Date(o),u=new Date(d),p=t[c.getMonth()],g=c.getDate(),v=t[u.getMonth()],h=u.getDate();return"W".concat(s," | ").concat(p," ").concat(g,", ").concat(i," - ").concat(v," ").concat(h,", ").concat(i)},l.transformMonthlyDateString=(e,t)=>{let a=e.split("-")[0];return"".concat(t," ").concat(a)},l.transformQuarterlyDateString=(e,t)=>{let a=e.split("-")[0];return"Q".concat(t," ").concat(a)},l.mapWeeklyPeriods=e=>{var t,a,n,i;return null!==(i=null==e?void 0:null===(n=e.find(e=>"weekly"===e.value))||void 0===n?void 0:null===(a=n.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:r().utc(t),title:l.transformWeeklyDateString(a)}}))&&void 0!==i?i:[]},l.mapMonthlyPeriods=e=>{var t,a,n,i;return null!==(i=null==e?void 0:null===(n=e.find(e=>"monthly"===e.value))||void 0===n?void 0:null===(a=n.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.reduce((e,t)=>{var a,n;let i=null!==(n=null==t?void 0:null===(a=t.child)||void 0===a?void 0:a.values.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:r().utc(t),title:l.transformMonthlyDateString(t,a)}}))&&void 0!==n?n:[];return e.concat(i)},[]))&&void 0!==i?i:[]},l.mapQuarterlyPeriods=e=>{var t,a,n,i;return null!==(i=null==e?void 0:null===(n=e.find(e=>"quarterly"===e.value))||void 0===n?void 0:null===(a=n.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.reduce((e,t)=>{var a,n;let i=null!==(n=null==t?void 0:null===(a=t.child)||void 0===a?void 0:a.values.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:r().utc(t),title:l.transformQuarterlyDateString(t,a)}}))&&void 0!==n?n:[];return e.concat(i)},[]))&&void 0!==i?i:[]}},24872:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var n=a(92027);class r{}r.sum=e=>e.reduce((e,t)=>e+t,0),r.average=(e,t)=>{if(!e.length)return"";let a=r.sum(e)/e.length;return n.Rx.roundToDecimalPoints(a,t)},r.calculatePercentage=(e,t)=>n.Rx.formatPercentage(e/(t||1))},97079:function(e,t,a){"use strict";var n=a(31549),r=a(53240),l=a(1311),i=a(1248);t.Z=e=>{let{disabled:t,value:a,onChange:s,groupingLabel:o}=e;return(0,n.jsx)(r.Z,{disabled:t,fullWidth:!0,label:"CSV grouping",name:"reportFileGroupingType",onChange:s,select:!0,value:a,"data-sentry-element":"TextField","data-sentry-component":"CSVGroupingPicker","data-sentry-source-file":"CSVGroupingPicker.tsx",children:["Single","Multiple","Aggregated"].map(e=>(0,n.jsx)(l.Z,{value:e,children:(0,i.Z)(o,e)},e))})}},91585:function(e,t,a){"use strict";var n=a(31549),r=a(44194),l=a(73207),i=a(53240),s=a(1311),o=a(60889),d=a(25882),c=a(1248);t.Z=e=>{let{disabled:t,formik:a,reportingRanges:u}=e,{label:p,options:g}=(0,r.useMemo)(()=>{switch(a.values.reportingRange){case"Weekly":return{label:"Weeks",options:null==u?void 0:u.weekly};case"Monthly":return{label:"Months",options:null==u?void 0:u.monthly};case"Quarterly":return{label:"Quarters",options:null==u?void 0:u.quarterly};default:throw Error("Unknown reporting range type")}},[a.values.reportingRange,u]);return(0,n.jsxs)(l.Z,{spacing:2,"data-sentry-element":"Stack","data-sentry-component":"ReportDateRangePicker","data-sentry-source-file":"ReportDateRangePicker.tsx",children:[(0,n.jsx)(i.Z,{disabled:t,fullWidth:!0,label:"Reporting range",name:"rangeType",onChange:e=>{a.setValues({...a.values,periods:[],reportingRange:e.target.value})},select:!0,value:a.values.reportingRange,"data-sentry-element":"TextField","data-sentry-source-file":"ReportDateRangePicker.tsx",children:c.T.map(e=>(0,n.jsx)(s.Z,{value:e,children:e},e))}),(0,n.jsx)(o.Z,{disableCloseOnSelect:!0,disabled:t,fullWidth:!0,getOptionLabel:e=>e.title,multiple:!0,onChange:(e,t)=>a.setFieldValue("periods",t),options:g,renderInput:e=>(0,n.jsx)(i.Z,{...e,label:p,placeholder:"Search and select ".concat(p.toLowerCase())}),renderOption:(e,t,a)=>{let{selected:l}=a;return(0,r.createElement)("li",{...e,key:t.title,children:[(0,n.jsx)(d.Z,{checked:l,style:{marginRight:8}}),t.title]})},value:a.values.periods,"data-sentry-element":"Autocomplete","data-sentry-source-file":"ReportDateRangePicker.tsx"})]})}},10604:function(e,t,a){"use strict";var n=a(31549),r=a(53240),l=a(1311),i=a(73207),s=a(78207),o=a(45576),d=a(49482),c=a(28027);t.Z=e=>{let{disabled:t,onChange:a}=e;return(0,n.jsx)(r.Z,{disabled:t,fullWidth:!0,label:"Marketplace",onChange:a,placeholder:"Search and select marketplaces",select:!0,"data-sentry-element":"TextField","data-sentry-component":"ReportMarketplaceSelect","data-sentry-source-file":"ReportMarketplaceSelect.tsx",children:Object.entries(c.aT).map(e=>{let[t,{name:a}]=e;return(0,n.jsx)(l.Z,{value:t,children:(0,n.jsxs)(i.Z,{alignItems:"center",direction:"row",spacing:1,children:[(0,n.jsx)(s.Z,{sx:{height:24,width:24},children:(0,n.jsx)(d.I,{icon:"circle-flags:".concat(t),sx:{height:"100%",width:"100%"}})}),(0,n.jsx)(o.Z,{variant:"body2",children:a})]})},a)})})}},4984:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var n=a(31549),r=a(29859),l=a(99876),i=a.n(l),s=a(73207),o=a(31925),d=a(66158);class c{}c.getMetadata=async e=>{var t,a,n,r,l,i;let s=await o.Z.fetchSCPMetadata(e),c=null==s?void 0:null===(a=s.metadata)||void 0===a?void 0:null===(t=a.viewsRoot)||void 0===t?void 0:t.views.find(e=>"brand-catalog-performance-default-view"===e.id),u=null!==(i=null==c?void 0:null===(r=c.filters.find(e=>"brand"===e.id))||void 0===r?void 0:null===(n=r.values)||void 0===n?void 0:n.map(e=>{var t,a;return{localizedDisplayValue:e.localizedDisplayValue,value:e.value,categories:(null==e?void 0:null===(t=e.child)||void 0===t?void 0:t.valueType)==="brand-category"?null==e?void 0:null===(a=e.child)||void 0===a?void 0:a.values:[]}}))&&void 0!==i?i:[],p=null==c?void 0:null===(l=c.filters.find(e=>"reporting-range"===e.id))||void 0===l?void 0:l.values;return{options:u,reportingRanges:{monthly:d.Z.mapMonthlyPeriods(p),quarterly:d.Z.mapQuarterlyPeriods(p),weekly:d.Z.mapWeeklyPeriods(p)}}};var u=a(11330),p=a(78839),g=a(19034),v=a(7597),h=a(44194),y=a(58362),m=a(53240),f=a(60889),S=a(13175),Z=a(23795),b=a(45304),k=a(18648),x=a(24643),D=a(46377),C=a(92027),w=a(28027),P=a(39378),R=a.n(P),T=a(17613),I=a.n(T),j=a(84084),A=a(83720),E=a(24872);class F{}F.aggregateData=e=>{let t=new Map;return e.forEach(e=>{let{period:a,marketplace:n,asin:r,"asin-title":l,category:i,...s}=e;t.has(r)||t.set(r,{marketplace:[n],period:[a],asin:[r],"asin-title":[l],category:[i]});let o=t.get(r);Object.entries(s).forEach(e=>{let[t,a]=e;t in o&&"-"!=="".concat(a)||(o[t]=[]),"-"!=="".concat(a)&&o[t].push(+a)})}),Array.from(t.values()).map(e=>Object.keys(F.SCP_AGGREGATORS).reduce((t,a)=>({...t,[a]:"".concat(F.SCP_AGGREGATORS[a](e))}),{}))},F.SCP_AGGREGATORS={"asin-title":e=>e["asin-title"][0],asin:e=>e.asin[0],category:e=>e.category[0],"impressions-count":e=>E.Z.sum(e["impressions-count"]),"impression-price":e=>E.Z.average(e["impression-price"],2),"same-day-shipping-impressions":e=>E.Z.sum(e["same-day-shipping-impressions"]),"one-day-shipping-impressions":e=>E.Z.sum(e["one-day-shipping-impressions"]),"two-day-shipping-impressions":e=>E.Z.sum(e["two-day-shipping-impressions"]),clicks:e=>E.Z.sum(e.clicks),"ctr-clicks":e=>E.Z.average(e["ctr-clicks"],2),"click-price":e=>E.Z.average(e["click-price"],2),"same-day-shipping-clicks":e=>E.Z.sum(e["same-day-shipping-clicks"]),"one-day-shipping-clicks":e=>E.Z.sum(e["one-day-shipping-clicks"]),"two-day-shipping-clicks":e=>E.Z.sum(e["two-day-shipping-clicks"]),"cart-adds-count":e=>E.Z.sum(e["cart-adds-count"]),"cart-adds-price":e=>E.Z.average(e["cart-adds-price"],2),"same-day-shipping-cart-adds":e=>E.Z.sum(e["same-day-shipping-cart-adds"]),"one-day-shipping-cart-adds":e=>E.Z.sum(e["one-day-shipping-cart-adds"]),"two-day-shipping-cart-adds":e=>E.Z.sum(e["two-day-shipping-cart-adds"]),"purchases-count":e=>E.Z.sum(e["purchases-count"]),"total-sales-purchases":e=>E.Z.sum(e["total-sales-purchases"]),"conversion-rate":e=>E.Z.calculatePercentage(E.Z.sum(e["purchases-count"]),E.Z.sum(e.clicks)),"purchase-price":e=>E.Z.average(e["purchase-price"],2),"same-day-shipping-purchases":e=>E.Z.average(e["same-day-shipping-purchases"],2),"one-day-shipping-purchases":e=>E.Z.sum(e["one-day-shipping-purchases"]),"two-day-shipping-purchases":e=>E.Z.sum(e["two-day-shipping-purchases"]),marketplace:e=>e.marketplace[0],period:e=>e.period[0]};class M{}M.PAGE_SIZE=100,M.generateSingleFetchInput=e=>{let{marketplaceCode:t,reportingRange:a,asins:n,brand:r,brandCategory:l,periodEndDate:i}=e;if(l&&!r)throw Error("Brand id must be provided if there is a brand category");let s=A.Z.getRangeFiltersByReportingRange(a,i),o=[{id:"reporting-range",value:a.toLowerCase(),valueType:null},...s];return r&&o.push({id:"brand",value:r,valueType:null}),l&&o.push({id:l.id,value:l.value,valueType:"brand-category"}),n&&o.push({id:"asins",value:n,valueType:"ASIN"}),{payload:{filterSelections:o,reportId:"brand-catalog-performance-report-table",viewId:"brand-catalog-performance-default-view",selectedCountries:[t],reportOperations:[{ascending:!1,pageNumber:1,pageSize:M.PAGE_SIZE,reportId:"brand-catalog-performance-report-table",reportType:"TABLE",sortByColumnId:"impressions-count"}]},periodEndDate:i.toISOString()}},M.generateAPIInputs=e=>{let{periodEndDates:t,...a}=e;return t.map(e=>M.generateSingleFetchInput({...a,periodEndDate:I().tz(e,C.SL)}))},M.fetchSCPAPIData=async(e,t,a,n,r,l,i,s)=>{let d;let c=[],u=M.PAGE_SIZE/i,p=0;do{let{totalItems:n,rows:g}=await o.Z.fetchSCPAPIData(e,R().cloneDeep({...a.payload,reportOperations:a.payload.reportOperations.map(e=>({...e,pageNumber:p+1}))}));if(void 0===d&&(d=Math.ceil(n/M.PAGE_SIZE)),!n){s((l+1)*u);continue}g.forEach(e=>{e.marketplace=w.aT[t].name,e.period=A.Z.getFormattedPeriod(r,a.periodEndDate),A.Z.sanitizeValuesWithComma(["asin-title"],e),c.push(e)});let v=p++/d*u;s(l*u+v),(p!==d||l!==i-1)&&await C.ZP.sleep(A.Z.getSellerCentralSleepTime())}while(p<d);return c},M.downloadData=async(e,t,a,n)=>{let{marketplaceCode:r,reportingRange:l,brand:i,asins:s,category:o,downloadDestinationType:d,reportFileGroupingType:c}=t,u=M.generateAPIInputs({marketplaceCode:r,periodEndDates:t.periods.map(e=>{let{date:t}=e;return t.utc().toISOString()}),reportingRange:l,brand:i,asins:s,...o&&{brandCategory:{id:"".concat(i,"-category"),value:o}}}),p=j.Z.SCP_DATA_COLUMNS,g=[],v=[];for(let[i,s]of u.entries())try{let o=await M.fetchSCPAPIData(e,r,s,g,l,i,u.length,a);"Multiple"===c?n({..."Local"!==d?{..."Google Sheet"===d?{csvData:o}:{sheetDataToWriteToDrive:A.Z.generateSheetData(o,p)}}:{csvText:A.Z.generateCSVText(o,p)},fileName:"".concat(l.toLowerCase(),"-").concat(s.periodEndDate.split("T")[0],"-scp-data-").concat(I()().toISOString().split(".")[0]),destination:d,reportFormData:t}):g.push(...o)}catch(e){A.Z.handleNetworkError(e),v.push(l)}if("Multiple"!==c){let e="Aggregated"===c,a=e?F.aggregateData(g):g,r="".concat(l.toLowerCase(),"-").concat(e?"aggregated-":"","scp-data-").concat(I()().toISOString().split(".")[0]);n({..."Local"!==d?{..."Google Sheet"===d?{csvData:a}:{sheetDataToWriteToDrive:A.Z.generateSheetData(e?F.aggregateData(g):g,p)}}:{csvText:A.Z.generateCSVText(e?F.aggregateData(g):g,p)},fileName:r,destination:d,reportFormData:t})}return v};var O=a(61600),_=a(97079),V=a(91585),G=a(10604),W=e=>{var t,a,r;let{disabled:l,metadata:i,isLoading:s,setDownloadProgress:o,setUploadProgress:d,downloadReport:c}=e,u=(0,b.v9)(x.Z.activeMarketplaceSelector),p=async e=>{try{let t=await M.downloadData(u,e,o,c);t.length&&(0,S.yv)("Some of the data for the following reporing ranges failed to download: ".concat(t.join(", ")),{persist:!0,preventDuplicate:!1,variant:"error"})}catch(e){var t;(0,S.yv)(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Something went wrong",{variant:"error"})}finally{d(0),o(null)}},g=(0,Z.TA)({initialValues:{downloadDestinationType:"Local",menuItemDestination:"Local",dataConfigurationId:"",marketplaceCode:"",isSavingToPreviousDestination:!1,periods:[],reportingRange:"Weekly",reportType:"SCP",reportFileGroupingType:"Single"},onSubmit:async(e,t)=>{o(0),await p(e),t.setSubmitting(!1)},validationSchema:k.Ry().shape({asins:k.Z_().test("maxLines","You cannot enter more than 100 ASINs at a time",e=>{var t,a,n;return(null!==(n=null==e?void 0:null===(a=e.split)||void 0===a?void 0:null===(t=a.call(e,"\n"))||void 0===t?void 0:t.length)&&void 0!==n?n:0)<=100}),brand:k.Z_(),marketplaceCode:k.Z_().required("You must select a marketplace"),periods:k.IX().required().test("periods","You must select at least one period",e=>!!e.length)})}),v=D.Z.isInvalidDestination(g.values),C=null==i?void 0:null===(a=i.options)||void 0===a?void 0:null===(t=a.find(e=>e.value===g.values.brand))||void 0===t?void 0:t.categories;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(G.Z,{disabled:l,onChange:e=>g.setFieldValue("marketplaceCode",e.target.value),"data-sentry-element":"ReportMarketplaceSelect","data-sentry-source-file":"SCPForm.tsx"}),(0,n.jsx)(_.Z,{disabled:l,groupingLabel:"Date Range",onChange:g.handleChange,value:g.values.reportFileGroupingType,"data-sentry-element":"CSVGroupingPicker","data-sentry-source-file":"SCPForm.tsx"}),(0,n.jsx)(V.Z,{disabled:l,formik:g,reportingRanges:i.reportingRanges,"data-sentry-element":"ReportDateRangePicker","data-sentry-source-file":"SCPForm.tsx"}),(0,n.jsx)(m.Z,{disabled:l,error:!!g.errors.asins,fullWidth:!0,helperText:g.touched.asins?g.errors.asins:null,id:"asins",label:"Enter up to 100 ASINs (optional)",multiline:!0,name:"asins",onBlur:g.handleBlur,onChange:g.handleChange,placeholder:"Enter ASINs separated by new lines",rows:8,value:g.values.asins,variant:"outlined","data-sentry-element":"TextField","data-sentry-source-file":"SCPForm.tsx"}),(0,n.jsx)(f.Z,{disabled:l,fullWidth:!0,getOptionLabel:e=>null==e?void 0:e.localizedDisplayValue,onChange:(e,t)=>{var a;g.setFieldValue("brand",null!==(a=null==t?void 0:t.value)&&void 0!==a?a:""),g.setFieldValue("category","")},options:(null==i?void 0:i.options)||[],renderInput:e=>(0,n.jsx)(m.Z,{...e,label:"Brand (optional)",placeholder:"Search and select a brand"}),renderOption:(e,t)=>(0,h.createElement)("li",{...e,key:t.localizedDisplayValue},t.localizedDisplayValue),"data-sentry-element":"Autocomplete","data-sentry-source-file":"SCPForm.tsx"}),g.values.brand?(0,n.jsx)(f.Z,{disabled:l,fullWidth:!0,getOptionLabel:e=>null==e?void 0:e.localizedDisplayValue,onChange:(e,t)=>{var a;g.setFieldValue("category",null!==(a=null==t?void 0:t.value)&&void 0!==a?a:"")},options:null!=C?C:[],renderInput:e=>(0,n.jsx)(m.Z,{...e,label:"Category (Optional)",placeholder:"Search and select a category"}),renderOption:(e,t)=>(0,h.createElement)("li",{...e,key:t.localizedDisplayValue},t.localizedDisplayValue),value:null!==(r=null==C?void 0:C.find(e=>e.value===g.values.category))&&void 0!==r?r:null},g.values.brand):null,(0,n.jsx)(O.Z,{disabled:l,formik:g,reportType:"SCP","data-sentry-element":"DataDestinationPicker","data-sentry-source-file":"SCPForm.tsx"}),(0,n.jsx)(y.Z,{disabled:!g.isValid||v||l,loading:s,onClick:g.submitForm,variant:"contained","data-sentry-element":"LoadingButton","data-sentry-source-file":"SCPForm.tsx",children:"Submit"})]})},L=()=>{let{loadingDetails:e,fetchMetadata:t,metadata:a,metadataStatus:r,setDownloadProgress:l,downloadReport:i,setUploadProgress:o}=(0,v.Z)(c.getMetadata,{options:[],reportingRanges:{monthly:[],quarterly:[],weekly:[]}});return(0,n.jsxs)(p.Z,{title:"Search Catalog Performance","data-sentry-element":"ReportFormContainer","data-sentry-component":"SCPReport","data-sentry-source-file":"SCPReport.tsx",children:[(0,n.jsx)(u.Z,{fetchMetadata:t,metadataStatus:r,"data-sentry-element":"NoActiveSessionAlert","data-sentry-source-file":"SCPReport.tsx"}),(0,n.jsxs)(s.Z,{spacing:2,"data-sentry-element":"Stack","data-sentry-source-file":"SCPReport.tsx",children:[(0,n.jsx)(W,{disabled:!!e||"success"!==r,downloadReport:i,isLoading:!!e,metadata:a,setDownloadProgress:l,setUploadProgress:o,"data-sentry-element":"SCPForm","data-sentry-source-file":"SCPReport.tsx"}),e?(0,n.jsx)(g.Z,{label:e.label,progress:e.progress}):null]})]})},N=()=>{let{appName:e}=(0,r.b)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i(),{"data-sentry-element":"Head","data-sentry-source-file":"scp.tsx",children:(0,n.jsx)("title",{children:"SCP Report | ".concat(e)})}),(0,n.jsx)(L,{"data-sentry-element":"SCPReport","data-sentry-source-file":"scp.tsx"})]})}},1248:function(e,t,a){"use strict";a.d(t,{T:function(){return n},Z:function(){return r}});let n=["Weekly","Monthly","Quarterly"],r=(e,t)=>({Aggregated:"One file for all ".concat(e,"s - Aggregated"),Multiple:"One file per-".concat(e),Single:"One file for all ".concat(e,"s")})[t]}},function(e){e.O(0,[718,509,40,987,888,774,179],function(){return e(e.s=67269)}),_N_E=e.O()}]);