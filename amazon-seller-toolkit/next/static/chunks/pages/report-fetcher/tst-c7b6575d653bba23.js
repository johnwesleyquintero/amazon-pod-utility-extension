!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f724175d-c812-422b-929a-aadbed366b82",e._sentryDebugIdIdentifier="sentry-dbid-f724175d-c812-422b-929a-aadbed366b82")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{3444:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/report-fetcher/tst",function(){return a(99953)}])},66158:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(17613),n=a.n(r);class l{}l.transformWeeklyDateString=e=>{let t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=e.split(" | "),r=a[0],n=a[1].split(", "),l=n[0].split(" - "),o=n[1],s=r.replace(/Week\s/,""),[i,d]=l,u=new Date(i),c=new Date(d),p=t[u.getMonth()],h=u.getDate(),v=t[c.getMonth()],g=c.getDate();return"W".concat(s," | ").concat(p," ").concat(h,", ").concat(o," - ").concat(v," ").concat(g,", ").concat(o)},l.transformMonthlyDateString=(e,t)=>{let a=e.split("-")[0];return"".concat(t," ").concat(a)},l.transformQuarterlyDateString=(e,t)=>{let a=e.split("-")[0];return"Q".concat(t," ").concat(a)},l.mapWeeklyPeriods=e=>{var t,a,r,o;return null!==(o=null==e?void 0:null===(r=e.find(e=>"weekly"===e.value))||void 0===r?void 0:null===(a=r.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:n().utc(t),title:l.transformWeeklyDateString(a)}}))&&void 0!==o?o:[]},l.mapMonthlyPeriods=e=>{var t,a,r,o;return null!==(o=null==e?void 0:null===(r=e.find(e=>"monthly"===e.value))||void 0===r?void 0:null===(a=r.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.reduce((e,t)=>{var a,r;let o=null!==(r=null==t?void 0:null===(a=t.child)||void 0===a?void 0:a.values.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:n().utc(t),title:l.transformMonthlyDateString(t,a)}}))&&void 0!==r?r:[];return e.concat(o)},[]))&&void 0!==o?o:[]},l.mapQuarterlyPeriods=e=>{var t,a,r,o;return null!==(o=null==e?void 0:null===(r=e.find(e=>"quarterly"===e.value))||void 0===r?void 0:null===(a=r.child)||void 0===a?void 0:null===(t=a.values)||void 0===t?void 0:t.reduce((e,t)=>{var a,r;let o=null!==(r=null==t?void 0:null===(a=t.child)||void 0===a?void 0:a.values.map(e=>{let{value:t,localizedDisplayValue:a}=e;return{date:n().utc(t),title:l.transformQuarterlyDateString(t,a)}}))&&void 0!==r?r:[];return e.concat(o)},[]))&&void 0!==o?o:[]}},91585:function(e,t,a){"use strict";var r=a(31549),n=a(44194),l=a(73207),o=a(53240),s=a(1311),i=a(60889),d=a(25882),u=a(1248);t.Z=e=>{let{disabled:t,formik:a,reportingRanges:c}=e,{label:p,options:h}=(0,n.useMemo)(()=>{switch(a.values.reportingRange){case"Weekly":return{label:"Weeks",options:null==c?void 0:c.weekly};case"Monthly":return{label:"Months",options:null==c?void 0:c.monthly};case"Quarterly":return{label:"Quarters",options:null==c?void 0:c.quarterly};default:throw Error("Unknown reporting range type")}},[a.values.reportingRange,c]);return(0,r.jsxs)(l.Z,{spacing:2,"data-sentry-element":"Stack","data-sentry-component":"ReportDateRangePicker","data-sentry-source-file":"ReportDateRangePicker.tsx",children:[(0,r.jsx)(o.Z,{disabled:t,fullWidth:!0,label:"Reporting range",name:"rangeType",onChange:e=>{a.setValues({...a.values,periods:[],reportingRange:e.target.value})},select:!0,value:a.values.reportingRange,"data-sentry-element":"TextField","data-sentry-source-file":"ReportDateRangePicker.tsx",children:u.T.map(e=>(0,r.jsx)(s.Z,{value:e,children:e},e))}),(0,r.jsx)(i.Z,{disableCloseOnSelect:!0,disabled:t,fullWidth:!0,getOptionLabel:e=>e.title,multiple:!0,onChange:(e,t)=>a.setFieldValue("periods",t),options:h,renderInput:e=>(0,r.jsx)(o.Z,{...e,label:p,placeholder:"Search and select ".concat(p.toLowerCase())}),renderOption:(e,t,a)=>{let{selected:l}=a;return(0,n.createElement)("li",{...e,key:t.title,children:[(0,r.jsx)(d.Z,{checked:l,style:{marginRight:8}}),t.title]})},value:a.values.periods,"data-sentry-element":"Autocomplete","data-sentry-source-file":"ReportDateRangePicker.tsx"})]})}},10604:function(e,t,a){"use strict";var r=a(31549),n=a(53240),l=a(1311),o=a(73207),s=a(78207),i=a(45576),d=a(49482),u=a(28027);t.Z=e=>{let{disabled:t,onChange:a}=e;return(0,r.jsx)(n.Z,{disabled:t,fullWidth:!0,label:"Marketplace",onChange:a,placeholder:"Search and select marketplaces",select:!0,"data-sentry-element":"TextField","data-sentry-component":"ReportMarketplaceSelect","data-sentry-source-file":"ReportMarketplaceSelect.tsx",children:Object.entries(u.aT).map(e=>{let[t,{name:a}]=e;return(0,r.jsx)(l.Z,{value:t,children:(0,r.jsxs)(o.Z,{alignItems:"center",direction:"row",spacing:1,children:[(0,r.jsx)(s.Z,{sx:{height:24,width:24},children:(0,r.jsx)(d.I,{icon:"circle-flags:".concat(t),sx:{height:"100%",width:"100%"}})}),(0,r.jsx)(i.Z,{variant:"body2",children:a})]})},a)})})}},99953:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var r=a(31549),n=a(29859),l=a(99876),o=a.n(l),s=a(73207),i=a(31925),d=a(66158);class u{}u.getMetadata=async e=>{var t,a,r,n,l;let o=await i.Z.fetchTSTMetadata(e),s=null==o?void 0:null===(a=o.metadata)||void 0===a?void 0:null===(t=a.viewsRoot)||void 0===t?void 0:t.views.find(e=>"top-search-terms-default-view"===e.id),u=null==s?void 0:null===(r=s.filters.find(e=>"reporting-range"===e.id))||void 0===r?void 0:r.values;return{options:null!==(l=null==s?void 0:null===(n=s.filters.find(e=>"category-dropdown"===e.id))||void 0===n?void 0:n.values)&&void 0!==l?l:[],reportingRanges:{monthly:d.Z.mapMonthlyPeriods(u),quarterly:d.Z.mapQuarterlyPeriods(u),weekly:d.Z.mapWeeklyPeriods(u)}}};var c=a(11330),p=a(78839),h=a(19034),v=a(7597),g=a(44194),m=a(58362),y=a(53240),f=a(60889),T=a(27308),S=a(13175),b=a(23795),x=a(45304),w=a(18648),Z=a(24643),k=a(46377),D=a(92027),R=a(39378),I=a.n(R),j=a(17613),C=a.n(j),A=a(61085),F=a(83720);class M{}M.PAGE_SIZE=100,M.generateSingleFetchInput=e=>{let{marketplaceCode:t,reportingRange:a,asins:r,brand:n,category:l,periodEndDate:o,searchTerm:s}=e,i=F.Z.getRangeFiltersByReportingRange(a,o),d=[{id:"reporting-range",value:a.toLowerCase(),valueType:null},...i];return r&&d.push({id:"asins",value:r,valueType:"ASIN"}),n&&d.push({id:"brand-freeform",value:n,valueType:"BRAND"}),l&&d.push({id:"category-dropdown",value:l,valueType:null}),s&&d.push({id:"search-term-freeform",value:s,valueType:"SEARCH_TERM"}),{payload:{filterSelections:d,reportId:"top-search-terms-report-table",viewId:"top-search-terms-default-view",selectedCountries:[t],reportOperations:[{ascending:!0,pageNumber:1,pageSize:M.PAGE_SIZE,reportId:"top-search-terms-report-table",reportType:"TABLE",sortByColumnId:"st-search-frequency"}]},periodEndDate:o.toISOString(),keyword:s,brand:n}},M.generateAPIInputs=e=>{let{periodEndDates:t,searchTerms:a=[],brands:r=[],...n}=e;return t.flatMap(e=>{let t=C().tz(e,D.SL);return a.length&&r.length?a.flatMap(e=>r.map(a=>M.generateSingleFetchInput({...n,brand:a,searchTerm:e,periodEndDate:t}))):a.length?a.map(e=>M.generateSingleFetchInput({...n,searchTerm:e,periodEndDate:t})):r.length?r.map(e=>M.generateSingleFetchInput({...n,brand:e,periodEndDate:t})):M.generateSingleFetchInput({...n,periodEndDate:t})})},M.fetchTSTAPIData=async(e,t,a,r,n,l,o)=>{let s;let d=M.PAGE_SIZE/l,u=0;do{let{totalItems:c,rows:p}=await i.Z.fetchTSTAPIData(e,I().cloneDeep({...t.payload,reportOperations:t.payload.reportOperations.map(e=>({...e,pageNumber:u+1}))}));if(void 0===s&&(s=Math.ceil(c/M.PAGE_SIZE)),!c){o((n+1)*d);continue}p.forEach(e=>{var n,l;e.period=F.Z.getFormattedPeriod(r,t.periodEndDate),e.keywords=null!==(n=t.keyword)&&void 0!==n?n:"",e.brands=null!==(l=t.brand)&&void 0!==l?l:"",F.Z.sanitizeValuesWithComma(["st-top-asin-title-1","st-top-asin-title-2","st-top-asin-title-3","st-search-term","st-top-category-1","st-top-category-2","st-top-category-3","st-top-brand-1","st-top-brand-2","st-top-brand-3"],e),a.push(e)});let h=u++/s*d;o(n*d+h),(u!==s||n!==l-1)&&await D.ZP.sleep(F.Z.getSellerCentralSleepTime())}while(u<s)},M.downloadData=async(e,t,a,r)=>{let{marketplaceCode:n,searchTerms:l,asins:o,brands:s,reportingRange:i,downloadDestinationType:d,category:u}=t,c=M.generateAPIInputs({asins:o,marketplaceCode:n,reportingRange:i,periodEndDates:t.periods.map(e=>{let{date:t}=e;return t.utc().toISOString()}),...u&&{category:u},...s&&{brands:F.Z.convertMultilineTextToArray(s)},...l&&{searchTerms:F.Z.convertMultilineTextToArray(l)}}),p=A.Z.TST_DATA_COLUMNS,h=[],v=[];for(let[t,r]of c.entries())try{await M.fetchTSTAPIData(e,r,h,i,t,c.length,a)}catch(e){F.Z.handleNetworkError(e),v.push("".concat(i," - (").concat((r.keyword,r.brand),")"))}return r({..."Local"!==d?{..."Google Sheet"===d?{csvData:h}:{sheetDataToWriteToDrive:F.Z.generateSheetData(h,p)}}:{csvText:F.Z.generateCSVText(h,p)},fileName:"".concat(i.toLowerCase(),"-tst-data-").concat(C()().toISOString().split(".")[0]),destination:d,reportFormData:t}),v};var E=a(61600),P=a(91585),_=a(10604),O=e=>{let{isLoading:t,disabled:a,metadata:n,setDownloadProgress:l,setUploadProgress:o,downloadReport:s}=e,i=(0,x.v9)(Z.Z.activeMarketplaceSelector),d=async e=>{try{let t=await M.downloadData(i,e,l,s);t.length&&(0,S.yv)("Some of the data for the following reporing ranges failed to download: ".concat(t.join(", ")),{persist:!0,preventDuplicate:!1,variant:"error"})}catch(e){var t;(0,S.yv)(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Something went wrong",{variant:"error"})}finally{o(0),l(null)}},u=(0,b.TA)({initialValues:{downloadDestinationType:"Local",menuItemDestination:"Local",dataConfigurationId:"",marketplaceCode:"",isSavingToPreviousDestination:!1,periods:[],reportingRange:"Weekly",reportType:"TST"},onSubmit:async(e,t)=>{l(0),await d(e),t.setSubmitting(!1)},validationSchema:w.Ry().shape({asins:w.Z_().test("maxAsins","You cannot enter more than 100 ASINs at a time",e=>{var t,a,r;return(null!==(r=null==e?void 0:null===(a=e.split)||void 0===a?void 0:null===(t=a.call(e,"\n"))||void 0===t?void 0:t.length)&&void 0!==r?r:0)<=100}),brands:w.Z_(),marketplaceCode:w.Z_().required("You must select a marketplace"),periods:w.IX().required().test("periods","You must select at least one period",e=>!!e.length)})}),c=(0,g.useMemo)(()=>{var e,t;return(null!==(t=null===(e=u.values.searchTerms)||void 0===e?void 0:e.split("\n").length)&&void 0!==t?t:0)>1},[u.values.searchTerms]),p=k.Z.isInvalidDestination(u.values);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.Z,{disabled:a,onChange:e=>u.setFieldValue("marketplaceCode",e.target.value),"data-sentry-element":"ReportMarketplaceSelect","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(P.Z,{disabled:a,formik:u,reportingRanges:n.reportingRanges,"data-sentry-element":"ReportDateRangePicker","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(y.Z,{disabled:a,error:!!u.errors.asins,fullWidth:!0,helperText:u.touched.asins?u.errors.asins:null,id:"asins",label:"Top clicked products (optional)",multiline:!0,name:"asins",onBlur:u.handleBlur,onChange:u.handleChange,placeholder:"Enter up to 100 ASINs separated by new lines",rows:4,value:u.values.asins,variant:"outlined","data-sentry-element":"TextField","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(y.Z,{disabled:a,error:!!u.errors.brands,fullWidth:!0,helperText:u.touched.brands?u.errors.brands:null,id:"brands",label:"Top clicked brands (optional)",multiline:!0,name:"brands",onBlur:u.handleBlur,onChange:u.handleChange,placeholder:"Enter brands separated by new lines",rows:4,value:u.values.brands,variant:"outlined","data-sentry-element":"TextField","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(f.Z,{disabled:a,fullWidth:!0,getOptionLabel:e=>null==e?void 0:e.localizedDisplayValue,onChange:(e,t)=>{var a;u.setFieldValue("category",null!==(a=null==t?void 0:t.value)&&void 0!==a?a:"")},options:(null==n?void 0:n.options)||[],renderInput:e=>(0,r.jsx)(y.Z,{...e,label:"Category (optional)",placeholder:"Search and select a category"}),renderOption:(e,t)=>(0,g.createElement)("li",{...e,key:t.localizedDisplayValue},t.localizedDisplayValue),"data-sentry-element":"Autocomplete","data-sentry-source-file":"TSTForm.tsx"}),c?(0,r.jsx)(T.Z,{severity:"info",children:"Adding multiple search terms lengthens the run time as each unique search term yields unique results."}):null,(0,r.jsx)(y.Z,{disabled:a,error:!!u.errors.searchTerms,fullWidth:!0,helperText:u.touched.searchTerms?u.errors.searchTerms:null,id:"searchTerms",label:"Search terms (optional)",multiline:!0,name:"searchTerms",onBlur:u.handleBlur,onChange:u.handleChange,placeholder:"Enter search terms separated by new lines",rows:4,value:u.values.searchTerms,variant:"outlined","data-sentry-element":"TextField","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(E.Z,{disabled:a,formik:u,reportType:"TST","data-sentry-element":"DataDestinationPicker","data-sentry-source-file":"TSTForm.tsx"}),(0,r.jsx)(m.Z,{disabled:!u.isValid||p||a,loading:t,onClick:u.submitForm,variant:"contained","data-sentry-element":"LoadingButton","data-sentry-source-file":"TSTForm.tsx",children:"Submit"})]})},W=()=>{let{metadata:e,loadingDetails:t,downloadReport:a,setUploadProgress:n,setDownloadProgress:l,fetchMetadata:o,metadataStatus:i}=(0,v.Z)(u.getMetadata,{options:[],reportingRanges:{monthly:[],quarterly:[],weekly:[]}});return(0,r.jsxs)(p.Z,{title:"Top Search Terms","data-sentry-element":"ReportFormContainer","data-sentry-component":"TSTReport","data-sentry-source-file":"TSTReport.tsx",children:[(0,r.jsx)(c.Z,{fetchMetadata:o,metadataStatus:i,"data-sentry-element":"NoActiveSessionAlert","data-sentry-source-file":"TSTReport.tsx"}),(0,r.jsxs)(s.Z,{spacing:2,"data-sentry-element":"Stack","data-sentry-source-file":"TSTReport.tsx",children:[(0,r.jsx)(O,{disabled:!!t||"success"!==i,downloadReport:a,isLoading:!!t,metadata:e,setDownloadProgress:l,setUploadProgress:n,"data-sentry-element":"TSTForm","data-sentry-source-file":"TSTReport.tsx"}),t?(0,r.jsx)(h.Z,{label:t.label,progress:t.progress}):null]})]})},N=()=>{let{appName:e}=(0,n.b)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o(),{"data-sentry-element":"Head","data-sentry-source-file":"tst.tsx",children:(0,r.jsx)("title",{children:"TST Report | ".concat(e)})}),(0,r.jsx)(W,{"data-sentry-element":"TSTReport","data-sentry-source-file":"tst.tsx"})]})}},1248:function(e,t,a){"use strict";a.d(t,{T:function(){return r},Z:function(){return n}});let r=["Weekly","Monthly","Quarterly"],n=(e,t)=>({Aggregated:"One file for all ".concat(e,"s - Aggregated"),Multiple:"One file per-".concat(e),Single:"One file for all ".concat(e,"s")})[t]}},function(e){e.O(0,[718,509,40,987,888,774,179],function(){return e(e.s=3444)}),_N_E=e.O()}]);